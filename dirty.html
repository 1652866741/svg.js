
<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <title></title>
  <script type="text/javascript" src="dist/svg.js"></script>
  <script type="text/javascript" src="src/morph.js"></script>
  <script type="text/javascript" src="src/helpers.js"></script>
  <script type="text/javascript" src="src/runner.js"></script>
  <script type="text/javascript" src="src/timeline.js"></script>
  <script type="text/javascript" src="src/controller.js"></script>



  <script type="text/javascript" src="src/transform.js"></script>
  <script type="text/javascript" src="src/matrix.js"></script>


</head>
<body style="background-color: #c7c7ff">

<div id="absolute"><label>Absolute: <input type="range" min="0" max="1" step="0.01"></slider></label><span></span></div>
<div id="position"><label>Position: <input type="range" min="0" max="5" step="0.01"></slider></label><span></span></div>

<!-- Making the svg -->
<svg width=1000px height=1000px id="canvas" viewbox="-1000 -1000 3000 3000">
  <rect x=50 y=100 width=200 height=100 stroke=none stroke-width=2 />
</svg>

<!-- Modifying the svg -->
<script>

let rect = SVG('rect').hide()
let {sin, PI: pi, round, sqrt} = Math

function getColor(t) {
  let a = round(80 * sin(2 * pi * t / 0.5 + 0.01) + 150)
  let b = round(50 * sin(2 * pi * t / 0.5 + 4.6) + 200)
  let c = round(100 * sin(2 * pi * t / 0.5 + 2.3) + 150)
  let color = `rgb(${a}, ${b}, ${c})`
  return color
}

// var rect1 = SVG('<rect>').addTo('svg').size(50, 50).move(100, 100)
// var rect2 = SVG('<rect>').addTo('svg').size(50, 50).move(100, 200)
//
// var anim1 = new SVG.Runner(1000).element(rect1).loop(5, true, 1000).move(200, 100)
// var anim2 = new SVG.Runner(1000).element(rect2).loop(5, true, 1000).move(200, 200)
//
// SVG('#absolute').on('input slide', function (e) {
//   var val = e.target.value
//   document.querySelector('#absolute span').textContent = val
//   anim1.absolute(val)
// })
//
// SVG('#position').on('input slide', function (e) {
//   var val = e.target.value
//   document.querySelector('#position span').textContent = val
//   anim2.position(val)
// })


// rect.animate(4000)
//     .during(t => rect.transform({scale: sqrt(1 + t), rotate: 720 * t}))
//   .after(500, ()=> {rect.attr('stroke', 'white')})
//     .queue(() => rect.attr('fill', getColor(0)))
//   .animate(1500, 500, true)
//     .queue(()=> {}, t => rect.attr('fill', getColor(t)))
//   .animate(1000, true)
//     .move(200, 200)
//     .size(300, 300)

// SVG.Animator.timeout(()=> { rect.animate().pause() }, 1000 - 10)
// SVG.Animator.timeout(()=> { rect.animate().play() }, 2000 - 10)



// SVG('rect')
//   .clone().show()
//   .animate()
//   .move(300, 200)


// for (let i = 0 ; i < 15; i++) {
//   for (let j = 0 ; j < 10; j++) {
//
//     // Make the rect
//     let o = i + j
//     let rect = SVG('rect').clone().show()
//       .width(40).height(40)
//       .x(50 * i).y(50 * j)
//       .attr('fill', getColor(o * 0.1))
//
//     // Move the rect
//     let {cx, cy} = rect.bbox()
//
//     // Animate the rect
//     rect.animate(3000, Math.random() * 2000)
//       // .during(t => rect.transform({rotate: 700 * t, origin: [cx, cy]}))
//       .transform({rotate: 720, origin: [cx, cy]})
//       // .during(t => rect.attr('transform', `rotate(${700 * t})`))
//       .during(t => rect.attr('fill', getColor(o * 0.1 + t)))
//   }
// }

//SVG.defaults.timeline.ease = '-'
//
// var r = new SVG.Runner(1000)
// var t = new SVG.Timeline()
// r.schedule(t, 200)
//   .animate(500).loop(5, true, 100)
//   .animate(600, 200, 'absolute')
//   .animate(600, 300)
//   .animate(600, 300, 'now')
//   .animate(1000, 0, 'absolute').loop(6, true)
//
// var canvas = SVG('svg')
// var schedule = t.schedule()
//
// schedule.forEach((s, i) => {
//   var rect = canvas.rect(s.duration / 10, 25)
//     .move(100 + s.start/10, 100 + i*30)
//     .attr('fill', '#777')
//
//   s.runner.element(rect)
//     .attr('fill', getColor(i*0.1))
//
//   // if (i===0)
//   //   s.runner.during(console.log)
// })
//
// var mover = canvas.line(100, 100, 100, 300).attr('stroke', 'black').clone()
// canvas.line(100, 300, 800, 300).attr('stroke', 'black')
//
// t.on('time', function (e) {
//   mover.x(100 + e.detail/10)
// })
//
//
// console.log(schedule)

// var bla = SVG('<rect>').size(0, 0).move(200, 200).addTo('svg')
// bla.animate().size(220, 200).queue(null, console.log)

// var randPoint = (x = 50, y = 50) => [
//   Math.random() * 100 - 50 + x,
//   Math.random() * 100 - 50 + y
// ]
//
// var poly = SVG('<polygon>').plot([
//   randPoint(),
//   randPoint(),
//   randPoint(),
//   randPoint(),
//   randPoint()
// ]).attr({fill: 'none', stroke: 'black'}).addTo('svg')
// var polyAni = poly.animate(new SVG.Spring(3000, 0))
//
// SVG.on(document, 'click', function (e) {
//   polyAni.plot([
//     randPoint(e.pageX-50, e.pageY-50),
//     randPoint(e.pageX+50, e.pageY-50),
//     randPoint(e.pageX+50, e.pageY),
//     randPoint(e.pageX+50, e.pageY+50),
//     randPoint(e.pageX-50, e.pageY+50)
//   ])
// })

// var mover = SVG('<ellipse>').size(50, 50).center(100, 100).addTo('svg')
// var anim = mover.animate(new SVG.Spring(500, 10))
//
// let date = +new Date
// SVG.on(document, 'mousemove', function (e) {
//   // if (+new Date - date > 50) {
//   //   date = +new Date
//   // } else {
//   //   return
//   // }
//
//   //var p = mover.point(e.pageX, e.pageY)
//   var p = mover.doc().point(e.clientX, e.clientY)
//   //var p = {x: e.pageX, y: e.pageY}
//   //console.log(p)
//   anim.transform({px: p.x - 100, py: p.y - 100})
//   //anim.center(p.x, p.y)
// })
/*
let canvas = SVG('#canvas')

let rectangle = canvas.rect(100, 200).move(100, 0)

let bbox = rectangle.bbox()

var timer = 0
rectangle.timeline().source(() => {
  timer += 2
  document.querySelector('#absolute span').textContent = timer
  return timer
})
rectangle.animate().transform({
  rotate: 90,
  origin: [bbox.cx, bbox.cy]
})*/


let canvas = SVG('#canvas')

SVG('#absolute').on('input slide', function (e) {
  var val = e.target.value

  canvas.clear()
  // canvas.ellipse(20, 20)
  // let re = canvas.rect(300, 150).move(100, 150).attr('opacity', 0.5)
  // re.clone()
  //   .transform({rotate: 45, skew: 30}, true)
  //
  // re.clone()
  //   .transform({
  //     rotate: 45, skew: 30, /*translate: [150, 140], */
  //   }, true)
  //   .transform({rotate: val, origin: 'bottom-right'}, true)
  //
  // re.clone()
  //   .transform({rotate: 45, skew: 30}, true)
  //   .transform({rotate: val, origin: 'bottom-right'}, true)
  //   .transform({skew}, true)
  let a = canvas.rect(200, 400).move(500, 400)
    .attr('opacity', 0.3)
    .addClass('pink')
    .transform({ px: 100, py: 500, origin: 'top-left' })


  var timer = 0
  a.timeline().source(() => {
    timer += 1
    document.querySelector('#absolute span').textContent = timer
    return timer
  })

  let obj = { rotate: val * 180, origin: 'center', translate: [300 * val, 0] }
  let obj2 = { rotate: -val * 180, origin: 'center' }

  a.clone() // startPosition
  a.clone().transform(obj, true).transform(obj2, true) // endPosition
})



// transform({})


// // Make the green rectange
// canvas.rect(200, 400).move(500, 400)
//   .attr('opacity', 0.3)
//   .addClass('green')

// Make the pink rectangle
let a = canvas.rect(200, 400).move(500, 400)
  .attr('opacity', 0.3)
  .addClass('pink')
  .transform({ tx: 100, ty: 500, origin: 'top-left' })

canvas.ellipse(20, 20).center(700, 1100)


var timer = 0
a.timeline().source(() => {
  timer += 1
  document.querySelector('#absolute span').textContent = timer
  return timer
})

let obj = { rotate: 180, origin: 'center', translate: [300, 0] }
let obj2 = { rotate: 360, origin: 'center' }

a.clone() // startPosition
//a.clone().transform(obj, true).transform(obj2, true) // endPosition

// that works
a.animate(new SVG.Spring(50, 30)).transform(obj)  // animation
// that breaks (why??)

var b = a.clone().animate(new SVG.Spring(500, 30))
//debugger
b.transform(obj)  // animation
//a.animate(300).transform(obj, true).transform(obj2, true) // animation




//setTimeout(()=>console.log(a.transform()), 6000)
//
// // Put an ellipse where we expect the object to be
// canvas.ellipse(30, 30).center(100, 500)
//   .attr('opacity', 0.3)
//   .addClass('dark-pink')


// var timeline = new SVG.Timeline().pause()
// var runner = new SVG.Runner(100000)
// runner.queue(null, function (pos) {
//   console.log(pos)
// })
// timeline.schedule(runner)
//
// runner.after(() => console.log('finished with after'))
// runner.on('finish', () => console.log('finished with on'))

//timeline.play()
//timeline.finish()



// var circle = SVG('<rect>').addTo('svg').size(100, 100).center(200, 200)
// var runner = circle.animate(1000)
//   .loop(3, true, 500)
//   .reverse()
//   .ease('<>')
//   .center(500, 200)
//   .during(t => circle.transform({rotate: 720 * t, origin: [200, 200]}))

// var r = new SVG.Runner(1000).loop(10, false, 100)
// r.queue(null, console.log)
//
// r.step(1200) // should be 0.1s
// r.step(-300) // should be 0.9s

/*
var timer = 0
SVG('svg').viewbox(-150, -150, 1000, 1000)
let rec1 = SVG('<rect>').addTo('svg')
  .size(100, 100)
  //.transform({translateX: -50, translateY: -50})
rec1.timeline().source(() => {
  timer += 2
  document.querySelector('#absolute span').textContent = timer
  return timer
})

var runner = rec1
  // .animate(100).attr('fill', '#fff')
  //.animate().transform({rotate: -45, origin: [50, 50]})
  .animate(200)
  .transform({
    rotate: 320,
    //origin: [200, 200],
  }, true)

  rec1.animate(150, 150, 'absolute')
    .transform({
      scale:2
    })
*/
    // .animate(400, 0, 'absolute')
    // .transform({
    //   rotate: 360,
    //   //origin: [200, 200],
    // }, true)

  // .animate(500, 0)
  // .transform({scale:2})
  // .transform({rotate: 360}, true)
  // .transform({translateX: 50, translateY: 50}, true)
  //.transform({translateX: 50, translateY: 50}, true)
   // .animate(500, 0, 'absolute')
   //    .transform({scale: 2}, true)
  // .animate(2000, 0, 'absolute')
  //    .transform({rotate: -300})

// r.step(300) // should be 0.1
// r.step(2 * 1100) // should be 0
// r.step(-50) // 0.05
// r.step(-100)
// r.step(-100) // 0.95

</script>

</body>
</html>
